<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Competitive Landscape Cable Map</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
        }
        
        #map {
            width: 100%;
            height: 100vh;
            background: #e8e8e8;
        }
        
        #loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #333;
            font-size: 18px;
            z-index: 1000;
        }
        
        .legend {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 12px 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.15);
            z-index: 1000;
            max-height: 80vh;
            overflow-y: auto;
            min-width: 200px;
            display: none;
        }
        
        .legend h3 {
            margin: 0 0 10px 0;
            font-size: 15px;
            color: #333;
        }
        
        .cable-item {
            display: flex;
            align-items: center;
            margin-bottom: 4px;
            cursor: pointer;
            padding: 3px 5px;
            border-radius: 3px;
            transition: background-color 0.2s;
        }
        
        .cable-item:hover {
            background-color: #f0f0f0;
        }
        
        .cable-item.hidden {
            opacity: 0.4;
        }
        
        .cable-color {
            width: 18px;
            height: 3px;
            margin-right: 8px;
            border-radius: 2px;
        }
        
        .cable-name {
            font-size: 13px;
            color: #444;
            line-height: 1.2;
        }
        
        /* Custom tooltip styles */
        .leaflet-tooltip.cable-tooltip {
            background: rgba(0, 0, 0, 0.9);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 6px 12px;
            font-size: 13px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        
        .leaflet-tooltip.landing-tooltip {
            background: white;
            color: #333;
            padding: 8px 12px;
            border: 1px solid #ddd;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }
        .map-tiles-inverted {
            filter: invert(-0.3) contrast(1.5) brightness(1.2);
        }
        .landing-name {
            font-weight: bold;
            font-size: 13px;
        }
        
        .landing-country {
            color: #666;
            font-size: 11px;
            margin-top: 2px;
        }
        .triangle-marker {
            background: none !important;
            border: none !important;
            box-shadow: none !important;
        }
        /* Landing point label styles */
        .landing-label {
            color: #2d00c8;
            font-size: 10px;
            font-weight: 500;
            background: none;
            border: none;
            box-shadow: none;
            white-space: nowrap;
        }
        /* Bigger labels for major cities */
        .landing-label.major-city {
            font-size: 14px;
            font-weight: 600;
        }
        /* Override Leaflet's default tile background */
        .leaflet-container {
            background: #e8e8e8;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <div id="loading">Loading map...</div>
    <div class="legend" id="legend">
        <h3>Competitive Landscape</h3>
        <div id="cable-list"></div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.antimeridian@3.1.0/antimeridian.js"></script>
    <script>
        // Wait for everything to load
        window.addEventListener('load', function() {
            // Check if Leaflet loaded
            if (typeof L === 'undefined') {
                document.getElementById('loading').innerHTML = 'Error: Leaflet failed to load. Please check your internet connection.';
                return;
            }
            
            console.log('Leaflet loaded successfully');
            initializeEverything();
        });
        
        function initializeEverything() {
            // Hide loading message
            document.getElementById('loading').style.display = 'none';
            
            // Show legend
            document.getElementById('legend').style.display = 'block';
            
            // Initialize the map
            const map = L.map('map', {
                center: [20, 0],
                zoom: 1,
                minZoom: 2,
                maxZoom: 8,
                worldCopyJump: true,
                zoomControl: false
            });

            // Add a light grey base map with no labels
            // Add ESRI gray canvas (very minimal)
            L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer/tile/{z}/{y}/{x}', {
                attribution: 'Tiles &copy; Esri',
                maxZoom: 16,
                continuousWorld: true,
                noWrap: false,
                bounds: [[-90, -270], [90, 270]]
            }).addTo(map);
            // Store all cable layers
            const cableLayers = {};
            
            // ============================================
            // CABLE DATA
            // ============================================
            
            const cables = [
                {
                    "type": "Feature",
                    "properties": {
                        "id": "ice-iv",
                        "name": "Ice IV (Expected RFS: Q4 2027)",
                        "color": "#939597"
                    },
                    "geometry": {
                        "type": "MultiLineString",
                        "coordinates": [[[103.85310700000069,1.293877684611663],[103.49999954035708,1.187251243111836],[103.34065268325203,1.215423766208059],[102.68278948352244,1.614486103864933],[102.15000511682186,1.862011036533579],[101.25000250948806,2.143087178471855],[99.87801031485228,3.194524477172223],[98.43750450188806,4.613591578862773],[97.76250497946822,5.286069860821008],[97.42500521915215,5.398081130463647],[95.40000665368001,5.845915088460266],[94.27500745064,5.061986954416114],[92.70000856638391,4.164912849976942],[90.00001047908802,1.018588540518982],[85.500013666928,0.118642751260435],[81.00001685476798,2.367912558705407],[79.65001781052403,2.742538766119824],[78.3000187674719,3.266814816815666],[74.58752139684402,5.659359572411489],[73.79730195664285,6.525105259563287],[71.54457355249673,9.11818824277241],[69.8598007524437,13.091497002845404],[65.75491565746178,16.02321181825744],[58.95003247279982,14.801154224791581],[55.35003502366785,13.273238157547594],[54.00003172921768,12.944520300761994],[52.65003102282712,12.615389555962425],[48.60003748762952,11.62547526916567],[45.450041792695906,10.853085032761474],[44.55004267686767,10.908328405024507],[43.20004363441179,12.615395567393394],[43.115666968498054,12.834868345343148],[42.77816893207962,13.054150695298627],[42.075044430179624,13.92930384327183],[41.568797673978786,14.801156146967152],[40.050047301873576,16.534199462919958],[39.03754654044679,18.251820899196428],[37.80004745981962,20.375041253465433],[37.0125525160315,22.05298584665826],[35.77504889375175,24.12261698700344],[34.76254961101568,25.75470426341523],[34.34067490927959,26.562513149236715],[33.750050327087614,27.364667993860262],[33.34277494878026,28.16105333067392],[32.82191098637826,28.95155473219332],[32.65318110412008,29.113614162980063]],[[71.54457355249673,9.11818824277241],[75.60001666057367,9.795747734568401],[76.26954603458404,9.938382891180906]],[[76.26954603458404,9.938382891180906],[80.24299047954267,13.063852694363918]],[[65.75491565746178,16.02321181825744],[65.52991781333536,16.45525448044254],[65.02502817100398,20.375041253465433],[63.4500292873438,22.469443964829516],[59.85003183761575,24.53265756616255],[58.50003279396771,24.813787071716945],[56.92503390971164,24.966862571111154],[56.333727795321586,25.121692810845413]],[[59.85003183761575,24.53265756616255],[58.95003092212701,24.003427781274887],[58.40778285872253,23.58412999999983]],[[103.85310700000069,1.293877684611663],[103.61250083587218,1.018534216615524],[103.61250083587218,0.793562652607196],[104.17500043739219,0.341586322057578],[104.8499999592161,0.235087761406669],[104.9624998807122,0.118588418888312],[105.86249924135629,-0.781386636225587],[106.65399868124656,-2.130918480960333],[106.93124848245826,-3.029995968008661],[106.76249860438416,-4.60145376483711],[106.53749876377611,-5.273944363641298],[106.82782855810404,-6.171876390816321]]]
                    }
                },
                
                {
                    "type": "Feature",
                    "properties": {
                        "id": "india-asia-xpress-iax",
                        "name": "India Asia Xpress (IAX) (RFS: Q4 2024)",
                        "color": "#d4a843"
                    },
                    "geometry": {
                        "type": "MultiLineString",
                        "coordinates": [[[81.13951857354486,16.175049115204825],[82.01872118892727,15.044700164166894],[81.82223885811331,11.127589656424089]],[[87.50654093847432,21.613825026350842],[88.64575957688014,2.546897235759658]],[[72.87590151562159,19.066189490208128],[71.32502370862383,16.965102599435927],[71.04513590397801,13.492128176464083],[72.50491087570272,9.361978911833972],[74.70002131774494,6.688675551202349],[75.37502083897188,5.659359572411489],[78.3000187674719,3.715978119298069],[79.65001781052403,3.191933974144809],[81.00001685476798,2.817450442654169],[85.500013666928,1.918228780215599],[90.00001047908802,2.817450442654169],[92.70000856638391,4.613591578862773],[94.27500745064,5.510071711803246],[95.40000665368001,6.069699469736006],[97.42500521915215,5.622041180883233],[98.10000474097609,5.286069860821008],[98.88750418310413,4.613591578862773],[100.01250338614413,3.266814816815666],[101.25000250948806,2.143087178471855],[102.15000187192003,1.805788280129153],[102.68279723997186,1.558264177552469],[103.34065102845322,1.383978004154865],[103.50000091556807,1.327518855965853],[103.64609081207688,1.338585852071497]],[[79.65001781052403,3.191933974144809],[80.43751725265209,5.435413643888211],[80.53985718074962,5.940820740520149]],[[98.10000474097609,5.286069860821008],[99.00000410340806,5.957818681088533],[100.06611334816643,6.613518860854109]],[[101.25000250948806,2.143087178471855],[101.41875238934823,2.592701464601932],[101.44360237174425,2.751228763607222]],[[75.37502083897188,5.659359572411489],[74.25002163652778,4.613591578862773],[73.54035213926461,4.212345781871782]],[[85.500013666928,1.918228780215599],[83.92501477969205,5.510071711803246],[83.2500152596562,7.744876956882131],[82.80001557844011,9.52441134501949],[81.45001653598388,11.735650161405832],[80.24298739105474,13.06385310188338]]]
                    }
                },
                {
                    "type": "Feature",
                    "properties": {
                        "id": "mist",
                        "name": "MIST (RFS: Dec 2024)",
                        "color": "#c96660"
                    },
                    "geometry": {
                        "type": "MultiLineString",
                        "coordinates": [[[81.00001685476798,3.042156042425856],[82.57501573902388,5.510047410567148],[82.80001557963192,7.744876956882131],[82.35001589841602,9.52441134501949],[81.45001653598388,11.294709319565477],[80.24298739105474,13.06385310188338]],[[72.87590260996693,19.07607425728523],[71.55002354923187,16.965102599435927],[71.49513558519409,13.492128176464083],[72.900022592881,9.443204702286902],[75.09513303492322,6.770440250104527],[78.69513048465001,3.940475772228814],[79.65001781052403,3.41655961832325],[81.00001685476798,3.042156042425856],[85.500013666928,2.817450442654169],[90.00001047908802,3.715978119298069],[92.70000856638391,4.837826391986557],[94.27500745064,5.733989114150127],[95.40000665368001,6.18155703253704],[97.42500521915215,5.845915088460266],[98.32500458158412,5.286069860821008],[99.11250402371216,4.613591578862773],[100.12500330644806,3.266814816815666],[101.25000250948806,2.19929675402769],[102.15000187192003,1.918228780215599],[102.68279723997186,1.614492576237963],[103.34065102845322,1.412069619499378],[103.50000091556807,1.38372807724675],[103.64609081207688,1.338585852071497]],[[97.42500521915215,5.845915088460266],[99.00000410340806,6.405200795356032],[100.06611334816643,6.613518860854109]],[[101.25000250948806,2.19929675402769],[101.36250242919627,2.592701464601932],[101.44360237174425,2.751228763607222]]]
                    }
                },
                {
                    "type": "Feature",
                    "properties": {
                        "id": "seamewe-4",
                        "name": "SeaMeWe-4 (RFS: Dec 2005)",
                        "color": "#507e9a"
                    },
                    "geometry": {
                        "type": "MultiLineString",
                        "coordinates": [[[101.25000250948806,2.480311786858737],[101.70000219070414,2.367912558705407],[102.220901821694,2.273260323566543]],[[66.60002705585578,19.95262290516439],[66.37502721524774,20.375041253465433],[66.60002705585578,23.298598065875897],[67.02854675228855,24.889731701235817]],[[91.99482906593992,21.42927456664916],[91.80000920395213,19.95262290516439],[88.20001175422391,13.492079936238724]],[[79.87208765380376,6.927036656836354],[79.4250179705119,5.957818681088533],[78.46194979910258,4.807252410277582]],[[103.64609081207688,1.338585852071497],[103.50000091556807,1.229280895999666],[103.34065102845322,1.299701188578927],[102.68279723997186,1.698782263242901],[102.15000187192003,2.03066189047467],[101.25000250948806,2.480311786858737],[100.46250306736002,3.266814816815666],[99.7875035455361,4.613591578862773],[99.00000410340806,5.286069860821008],[97.42500521915215,6.405200795356032],[95.40000665368001,8.190543417795496],[93.14492825119876,9.52441134501949],[91.80000920395213,10.41081650540272],[90.00001047908802,12.395734000022975],[88.20001175422391,13.492079936238724],[83.70001494206389,13.929255692764443],[81.45001653598388,13.273238157547594],[80.24298739105474,13.06385310188338],[81.45001653598388,11.073982781226615],[82.1250160560201,9.52441134501949],[82.575015737236,7.744852765542954],[82.35001589841602,5.51002310933014],[81.00001685476798,4.613591578862773],[78.69513048465001,4.613591578862773],[76.39024411453221,6.852191098754328],[74.19513367248999,9.52441134501949],[72.84513462884213,13.492128176464083],[72.2250230710558,16.965102599435927],[72.87590260996693,19.07607425728523]],[[7.755438741914387,36.90282046530194],[7.875068657167333,37.23235432155614],[7.987568577471261,37.94551049545967],[8.10006849777537,38.38775473578444]],[[9.867357245811593,37.276816253475154],[9.675067382031267,37.589786573603064],[9.000067859611436,38.38775473578444]],[[13.358654772543574,38.11612161658339],[13.05006499115128,38.38775473578444],[12.600065309935387,38.51986519151931],[12.150065628719313,38.38775473578444],[10.348617229769278,38.38775473578444],[9.000067859611436,38.38775473578444],[8.10006849777537,38.38775473578444],[7.650068816559295,38.651811712711336],[6.187569852607326,41.74435878948223],[5.372530429989069,43.29362778902908]],[[39.18275647850768,21.481533475502996],[39.26254642198353,20.375041253465433],[40.61254546563157,18.251816319028222],[41.62504474836765,16.534196198259725],[42.4125441904955,14.801154224791581],[42.918793831863546,13.92930384327183],[43.20004363262354,13.054150695298627],[43.31254355292765,12.834868817846521],[43.39691849315569,12.615395567393394],[43.81879319429551,12.395734000022975],[44.55004267627159,12.120896898039394],[45.450042038703735,12.395734000022975],[48.60003980721571,13.163718917913586],[55.35003502545574,15.669513225155248],[58.95003247518379,17.395022634700517],[62.55002992491184,19.95262290516439],[66.60002705585578,19.95262290516439],[70.20002450558383,19.529070924350908],[72.87590260996693,19.07607425728523]],[[62.55002992491184,19.95262290516439],[62.55002992491184,22.469443964829516],[59.85003183761575,24.12261698700435],[58.50003279396771,24.583819112323365],[56.92503390971164,24.89034854048814],[56.33372432860119,25.121690004958644]],[[100.06611334816643,6.613518860854109],[100.0579133539753,6.354447103901104],[99.99248340032653,6.205536229871337],[99.67350362629472,5.956366566270154],[99.00000410340806,5.845915088460266],[97.42500521915215,6.405200795356032]],[[29.8935130590948,31.191465077638455],[30.825052399183495,30.901396088515508],[31.387552000703497,30.708097004575936],[31.9500516022235,30.49024170709155],[32.287551363135464,30.271897570624173],[32.52993119143143,29.972545436050364]],[[12.150065628719313,38.38775473578444],[12.262565549023423,38.21117903702318],[12.262565549023423,36.87321951208928],[12.487565389631278,36.24065523321488],[12.712565230239315,35.876870570092834],[13.500064672367355,35.419780517080355],[14.400064034799321,34.960082324548345],[16.65006244087933,34.49779087043369],[19.350060528175415,34.867831005273345],[22.050058614875596,34.57501887961886],[25.200056383983473,33.846256070003854],[28.800053833711523,32.52821504536491],[29.8935130590948,31.191465077638455],[30.825052399183495,30.828970604876503],[31.387552000703497,30.61132334760356],[31.9500516022235,30.393250512072004],[32.287551363135464,30.223305674181642],[32.54282118230001,29.95909144105574],[32.59687614400701,29.63833609362628],[32.76567602442743,29.344566989489813],[33.04692582518743,28.95155473219332],[33.52527548632113,28.161052262220792],[34.48129980906351,27.364667993860262],[35.43754913164762,26.562513149236715],[36.22504857377548,25.75470426341523],[37.237547856509735,24.12261698700344],[38.47504697985549,22.05298561667754],[39.18275647850768,21.481533475502996]]]
                    }
                },
                {
                    "type": "Feature",
                    "properties": {
                        "id": "seamewe-6",
                        "name": "SeaMeWe-6 (Expected RFS: 2026)",
                        "color": "#028A0F"
                    },
                    "geometry": {
                        "type": "MultiLineString",
                        "coordinates": [[[35.88754881405568,24.12261698700344],[36.90004809500369,24.361968609765935],[37.80004745803156,24.32780311165181],[38.10697724059967,24.070648010417838]],[[5.372530429989069,43.29362778902908],[5.287570490175359,41.74435878948223],[5.850070091695361,38.651811712711336],[6.750069455319493,37.94551049545967],[9.000067860207336,37.411283634923244],[10.34861723036536,37.411283634923244],[11.137566345387336,37.23235432155614],[11.812565868412525,35.419780517080355],[14.400064035395404,33.565491482352044],[16.650062441475413,32.62301664000789],[19.350060528771497,33.001218522654476],[22.050058614875596,33.174022096718055],[25.200056384579554,32.43331330641721],[27.900054471875638,31.766210259727007],[31.050052239195633,31.798087367585257],[32.06255152193171,31.510798430049064],[32.28445136473581,31.25927814644905]],[[32.28445136473581,31.25927814644905],[32.06255152193171,30.837020582397155],[32.06255152193171,30.07738596207985],[32.23124640063861,29.63833609362628],[32.40005128284368,29.082725788288755],[33.08276564295245,28.365936333863583]],[[32.28445136473581,31.25927814644905],[32.006301561779566,30.837020582397155],[31.9500516016276,30.07738596207985],[32.17500143988696,29.63833609362628],[32.28755136253957,29.082725788288755],[33.08276564295245,28.365936333863583]],[[33.08276564295245,28.365936333863583],[33.35680060388853,28.161052262220792],[33.80630028723958,27.364667993860262],[34.42504984950763,26.562513149236715],[34.87504953131979,25.75470426341523],[35.88754881405568,24.12261698700344],[37.12504793739979,22.05298561667754],[37.91254737952765,20.375041253465433],[39.26254642257961,18.251816319028222],[40.27504570531769,16.534196198259725],[41.68129470911569,14.801154224791581],[42.18754435048373,13.92930384327183],[42.83441889223159,13.054150695298627],[43.14379367306766,12.834868817846521],[43.2281686132957,12.615395567393394],[43.50941841345962,12.395734000022975],[44.55004267627159,11.018774999640526],[45.450042037511935,10.963556857789316],[48.60003980661981,11.735650161405832],[52.65003693696785,12.72515592356304],[54.00003598299986,13.054150695298627],[55.35003502307177,13.273238157547594],[58.9500324733959,15.018578573757472],[60.30003151883183,15.669513225155248],[65.75491565746178,16.45525448044254],[70.2549124696218,13.25182881322956],[71.71468744134651,9.199470523025733],[73.90979788338855,6.525105259563287],[74.70002131714794,5.659359572411489],[78.3000187674719,3.491423322320592],[79.65001781052403,2.967259208499635],[81.00001685476798,2.592701464601932],[85.500013666928,1.018588540518982],[90.00001047908802,1.91828308225627],[92.70000856638391,4.389285926050993],[94.27500745064,5.286069860821008],[95.40000665368001,5.957818681088533],[97.42500521915215,5.510071711803246],[97.87500490036805,5.286069860821008],[98.66250434249609,4.613591578862773],[99.90000346584002,3.266814816815666],[101.25000250948806,2.03066189047467],[102.15000187192003,1.524657538529121],[102.68279723997186,1.41768673166663],[103.34065102845322,1.074949758433191],[103.50000091556807,1.144999057563372],[103.64609081207688,1.338585852071497]],[[44.55004267627159,11.018774999640526],[43.65004331383962,11.399928123027385],[43.14799366949638,11.594869371447825]],[[79.65001781052403,2.967259208499635],[79.87501765113208,3.191933974144809],[80.550017172956,5.435413643888211],[80.53985718074962,5.940820740520149]],[[101.25000250948806,2.03066189047467],[101.4750023495002,2.592701464601932],[101.44360237174425,2.751228763607222]],[[90.00001047908802,1.91828308225627],[90.90000984092408,5.061986954416114],[91.35000952273606,9.52441134501949],[92.70000856638391,14.801154224791581],[92.70000856578802,17.82393441253792],[92.02500904336819,19.95262290516439],[91.99482906593992,21.42927456664916]],[[74.70002131714794,5.659359572411489],[74.25002163652778,4.837826391986557],[73.54027200000027,4.211916943627916]],[[70.2549124696218,13.25182881322956],[71.1000238680158,16.965102599435927],[72.87590260996693,19.07607425728523]],[[65.75491565746178,16.45525448044254],[65.47502785162398,20.375041253465433],[66.15002737344808,23.298598065875897],[67.02854675228855,24.889731701235817]],[[85.500013666928,1.018588540518982],[83.70001494146798,5.510071711803246],[83.02501541964405,7.744876956882131],[82.57501573842798,9.52441134501949],[81.45001653598388,11.515266158038768],[80.24298739105474,13.06385310188338]],[[51.5193877385264,25.294536999999895],[52.20003725694376,26.05828756029904]],[[54.419075684956134,24.443964572625426],[54.34014573908288,24.872582666687173]],[[60.30003151883183,15.669513225155248],[60.30003151883183,19.104405475930452],[60.30003151883183,22.469443964829516],[59.85003183761575,23.09178547692239],[58.95003247518379,23.65974644119216],[58.61253271367574,23.81422051502533],[57.661372759507515,24.420846844473278],[57.15003374972377,25.348717422116714],[56.812533989407704,26.1593079707739],[56.58753414879967,26.512189502051797],[56.362534308191634,26.512189502051797],[55.80003470667163,26.1593079707739],[55.35003502545574,25.855985466072205],[54.34014573908288,24.872582666687173],[52.87503677817179,25.450342946923914],[52.20003725694376,26.05828756029904],[51.637537655423756,26.36108632539156],[51.187537974207686,26.461843796188983],[50.57595273852649,26.229438]],[[58.61253271367574,23.81422051502533],[58.40778285872253,23.58412999999983]],[[51.187537974207686,26.461843796188983],[50.312048594412666,27.189831947123228],[48.5317798555716,29.92363278689715]],[[50.214198663730556,26.28537535931817],[50.68827989536378,26.827599873974826]],[[47.97630977972595,29.371633383730508],[48.71253972751964,29.624569166349684]]]
                    }
                }
            ];

            // ============================================
            // LANDING POINTS DATA (from paste-2.txt)
            // ============================================
            
            const landingPoints = [
                {
                    "properties": {
                        "name": "Agat, Guam"
                    },
                    "geometry": {
                        "coordinates": [144.65753000000052, 13.385309999999615]
                    }
                },
                {
                    "properties": {
                        "name": "Alexandria, Egypt"
                    },
                    "geometry": {
                        "coordinates": [29.889799154879793, 31.191886381300385]
                    }
                },
                {
                    "properties": {
                        "name": "Alupang, Guam"
                    },
                    "geometry": {
                        "coordinates": [144.776754, 13.490037]
                    }
                },
                {
                    "properties": {
                        "name": "Annaba, Algeria"
                    },
                    "geometry": {
                        "coordinates": [7.755439835067562, 36.902343529231146]
                    }
                },
                {
                    "properties": {
                        "name": "Baler, Philippines"
                    },
                    "geometry": {
                        "coordinates": [121.56018214238252, 15.7615293728581]
                    }
                },
                {
                    "properties": {
                        "name": "Batam, Indonesia"
                    },
                    "geometry": {
                        "coordinates": [104.01664054897991, 1.066796188550793]
                    }
                },
                {
                    "properties": {
                        "name": "Batangas, Philippines"
                    },
                    "geometry": {
                        "coordinates": [121.06492987806165, 13.765553306627538]
                    }
                },
                {
                    "properties": {
                        "name": "Bauang, Philippines"
                    },
                    "geometry": {
                        "coordinates": [120.35558309999966, 16.51402480000008]
                    }
                },
                {
                    "properties": {
                        "name": "Bizerte, Tunisia"
                    },
                    "geometry": {
                        "coordinates": [9.867352401468954, 37.276349513656555]
                    }
                },
                {
                    "properties": {
                        "name": "Busan, South Korea"
                    },
                    "geometry": {
                        "coordinates": [128.99929925728011, 35.17014221411413]
                    }
                },
                {
                    "properties": {
                        "name": "Changi, Singapore"
                    },
                    "geometry": {
                        "coordinates": [104.00411409999965, 1.373499297000449]
                    }
                },
                {
                    "properties": {
                        "name": "Changi North, Singapore"
                    },
                    "geometry": {
                        "coordinates": [103.9870122887188, 1.389044778364265]
                    }
                },
                {
                    "properties": {
                        "name": "Changi South, Singapore"
                    },
                    "geometry": {
                        "coordinates": [103.9870122887188, 1.389044778364265]
                    }
                },
                {
                    "properties": {
                        "name": "Cherating, Malaysia"
                    },
                    "geometry": {
                        "coordinates": [103.39365333405976, 4.130238298773818]
                    }
                },
                {
                    "properties": {
                        "name": "Chennai, India"
                    },
                    "geometry": {
                        "coordinates": [80.24308379664043, 13.06348539106232]
                    }
                },
                {
                    "properties": {
                        "name": "Chikura, Japan"
                    },
                    "geometry": {
                        "coordinates": [139.95466259014782, 34.976657744880164]
                    }
                },
                {
                    "properties": {
                        "name": "Chongming, China"
                    },
                    "geometry": {
                        "coordinates": [121.39520308159317, 31.619883221433906]
                    }
                },
                {
                    "properties": {
                        "name": "Chung Hom Kok, China"
                    },
                    "geometry": {
                        "coordinates": [114.2030206766037, 22.222049985803473]
                    }
                },
                {
                    "properties": {
                        "name": "Colombo, Sri Lanka"
                    },
                    "geometry": {
                        "coordinates": [79.87199030952667, 6.926734329228445]
                    }
                },
                {
                    "properties": {
                        "name": "Cox's Bazar, Bangladesh"
                    },
                    "geometry": {
                        "coordinates": [91.99493094027171, 21.42917958893072]
                    }
                },
                {
                    "properties": {
                        "name": "Danang, Vietnam"
                    },
                    "geometry": {
                        "coordinates": [108.21474366875417, 16.051559827539638]
                    }
                },
                {
                    "properties": {
                        "name": "Davao, Philippines"
                    },
                    "geometry": {
                        "coordinates": [125.61277821882337, 7.079988883160643]
                    }
                },
                {
                    "properties": {
                        "name": "Digha, India"
                    },
                    "geometry": {
                        "coordinates": [87.50654093847432, 21.621856500843982]
                    }
                },
                {
                    "properties": {
                        "name": "Eureka, CA, United States"
                    },
                    "geometry": {
                        "coordinates": [-124.159554, 40.803255000000355]
                    }
                },
                {
                    "properties": {
                        "name": "Fangshan, Taiwan"
                    },
                    "geometry": {
                        "coordinates": [120.66209813218148, 22.249258581382197]
                    }
                },
                {
                    "properties": {
                        "name": "Fujairah, United Arab Emirates"
                    },
                    "geometry": {
                        "coordinates": [56.33372573425405, 25.12169311729696]
                    }
                },
                {
                    "properties": {
                        "name": "Grover Beach, CA, United States"
                    },
                    "geometry": {
                        "coordinates": [-120.62142234655879, 35.1206334382351]
                    }
                },
                {
                    "properties": {
                        "name": "Hermosa Beach, CA, United States"
                    },
                    "geometry": {
                        "coordinates": [-118.39954892055475, 33.862232632157735]
                    }
                },
                {
                    "properties": {
                        "name": "Hulhumale, Maldives"
                    },
                    "geometry": {
                        "coordinates": [73.54015885755544, 4.211942635751779]
                    }
                },
                {
                    "properties": {
                        "name": "Jakarta, Indonesia"
                    },
                    "geometry": {
                        "coordinates": [106.82785500280222, -6.171598654655946]
                    }
                },
                {
                    "properties": {
                        "name": "Jeddah, Saudi Arabia"
                    },
                    "geometry": {
                        "coordinates": [39.18276132165815, 21.481258967424996]
                    }
                },
                {
                    "properties": {
                        "name": "Karachi, Pakistan"
                    },
                    "geometry": {
                        "coordinates": [67.02854237669561, 24.88937409747322]
                    }
                },
                {
                    "properties": {
                        "name": "Kauditan, Indonesia"
                    },
                    "geometry": {
                        "coordinates": [125.06561063769091, 1.378623021535939]
                    }
                },
                {
                    "properties": {
                        "name": "Keawaula, HI, United States"
                    },
                    "geometry": {
                        "coordinates": [-158.2420376129735, 21.548768815961424]
                    }
                },
                {
                    "properties": {
                        "name": "Kuala Sedili, Malaysia"
                    },
                    "geometry": {
                        "coordinates": [104.11414260000058, 1.925879632999907]
                    }
                },
                {
                    "properties": {
                        "name": "La Union, Philippines"
                    },
                    "geometry": {
                        "coordinates": [120.38963738769527, 16.582590683428545]
                    }
                },
                {
                    "properties": {
                        "name": "Lantau Island, China"
                    },
                    "geometry": {
                        "coordinates": [113.94833335702553, 22.271491582355683]
                    }
                },
                {
                    "properties": {
                        "name": "Lingang, China"
                    },
                    "geometry": {
                        "coordinates": [121.89608163301598, 30.935661747314708]
                    }
                },
                {
                    "properties": {
                        "name": "Lingshui, China"
                    },
                    "geometry": {
                        "coordinates": [110.04937200000029, 18.389897000000236]
                    }
                },
                {
                    "properties": {
                        "name": "Luna, Philippines"
                    },
                    "geometry": {
                        "coordinates": [120.35484390000022, 16.830712289999493]
                    }
                },
                {
                    "properties": {
                        "name": "Machilipatnam, India"
                    },
                    "geometry": {
                        "coordinates": [81.13951857354486, 16.175049115204825]
                    }
                },
                {
                    "properties": {
                        "name": "Magachgil, Yap, Micronesia"
                    },
                    "geometry": {
                        "coordinates": [138.06149986878208, 9.443922836169385]
                    }
                },
                {
                    "properties": {
                        "name": "Makaha, HI, United States"
                    },
                    "geometry": {
                        "coordinates": [-158.2206478576183, 21.463431186887963]
                    }
                },
                {
                    "properties": {
                        "name": "Manado, Indonesia"
                    },
                    "geometry": {
                        "coordinates": [124.83960982123124, 1.490831387793467]
                    }
                },
                {
                    "properties": {
                        "name": "Maruyama, Japan"
                    },
                    "geometry": {
                        "coordinates": [139.97546699999984, 35.005432999999265]
                    }
                },
                {
                    "properties": {
                        "name": "Marseille, France"
                    },
                    "geometry": {
                        "coordinates": [5.372629023073098, 43.29316463678684]
                    }
                },
                {
                    "properties": {
                        "name": "Matara, Sri Lanka"
                    },
                    "geometry": {
                        "coordinates": [80.53986093015084, 5.940833037393244]
                    }
                },
                {
                    "properties": {
                        "name": "Melaka, Malaysia"
                    },
                    "geometry": {
                        "coordinates": [102.22090025859913, 2.273178376445331]
                    }
                },
                {
                    "properties": {
                        "name": "Mersing, Malaysia"
                    },
                    "geometry": {
                        "coordinates": [103.84990301084824, 2.295511672819276]
                    }
                },
                {
                    "properties": {
                        "name": "Minamiboso, Japan"
                    },
                    "geometry": {
                        "coordinates": [139.9609790000003, 34.9740779999996]
                    }
                },
                {
                    "properties": {
                        "name": "Morib, Malaysia"
                    },
                    "geometry": {
                        "coordinates": [101.4436141980139, 2.751191204441439]
                    }
                },
                {
                    "properties": {
                        "name": "Morro Bay, CA, United States"
                    },
                    "geometry": {
                        "coordinates": [-120.84720343661348, 35.3666813511006]
                    }
                },
                {
                    "properties": {
                        "name": "Mumbai, India"
                    },
                    "geometry": {
                        "coordinates": [72.87590151562159, 19.07579693373203]
                    }
                },
                {
                    "properties": {
                        "name": "Nanhui, China"
                    },
                    "geometry": {
                        "coordinates": [121.92506915087795, 30.864713861582327]
                    }
                },
                {
                    "properties": {
                        "name": "Ngeremlengui, Palau"
                    },
                    "geometry": {
                        "coordinates": [134.56094082517401, 7.531746239289517]
                    }
                },
                {
                    "properties": {
                        "name": "Palermo, Italy"
                    },
                    "geometry": {
                        "coordinates": [13.358365553402518, 38.12150089552133]
                    }
                },
                {
                    "properties": {
                        "name": "Piti, Guam"
                    },
                    "geometry": {
                        "coordinates": [144.69474214461212, 13.464655237903562]
                    }
                },
                {
                    "properties": {
                        "name": "Quy Nhon, Vietnam"
                    },
                    "geometry": {
                        "coordinates": [109.21965018343205, 13.782957863531687]
                    }
                },
                {
                    "properties": {
                        "name": "Rosarito, Mexico"
                    },
                    "geometry": {
                        "coordinates": [-117.06377809999996, 32.357601899999985]
                    }
                },
                {
                    "properties": {
                        "name": "Satun, Thailand"
                    },
                    "geometry": {
                        "coordinates": [100.06611799999914, 6.613467]
                    }
                },
                {
                    "properties": {
                        "name": "Shantou, China"
                    },
                    "geometry": {
                        "coordinates": [116.67547986258927, 23.354554663214007]
                    }
                },
                {
                    "properties": {
                        "name": "Shima, Japan"
                    },
                    "geometry": {
                        "coordinates": [136.87439133474103, 34.33683057441225]
                    }
                },
                {
                    "properties": {
                        "name": "Songkhla, Thailand"
                    },
                    "geometry": {
                        "coordinates": [100.5951000000003, 7.198819999999446]
                    }
                },
                {
                    "properties": {
                        "name": "Sriracha, Thailand"
                    },
                    "geometry": {
                        "coordinates": [100.93056914143179, 13.174368777461584]
                    }
                },
                {
                    "properties": {
                        "name": "Suez, Egypt"
                    },
                    "geometry": {
                        "coordinates": [32.53012931569517, 29.9722883988634]
                    }
                },
                {
                    "properties": {
                        "name": "Tanguisson Point, Guam"
                    },
                    "geometry": {
                        "coordinates": [144.80934665104422, 13.549098008782185]
                    }
                },
                {
                    "properties": {
                        "name": "Tanjung Pakis, Indonesia"
                    },
                    "geometry": {
                        "coordinates": [107.12089678739565, -5.981255891395774]
                    }
                },
                {
                    "properties": {
                        "name": "Tanshui, Taiwan"
                    },
                    "geometry": {
                        "coordinates": [121.46258584635854, 25.18136115573805]
                    }
                },
                {
                    "properties": {
                        "name": "Toucheng, Taiwan"
                    },
                    "geometry": {
                        "coordinates": [121.80145279380189, 24.863592858849902]
                    }
                },
                {
                    "properties": {
                        "name": "Tseung Kwan O, China"
                    },
                    "geometry": {
                        "coordinates": [114.25868469966966, 22.31829585896108]
                    }
                },
                {
                    "properties": {
                        "name": "Tuas, Singapore"
                    },
                    "geometry": {
                        "coordinates": [103.64707112328632, 1.338192522185158]
                    }
                },
                {
                    "properties": {
                        "name": "Tungku, Brunei"
                    },
                    "geometry": {
                        "coordinates": [114.88583269289208, 4.926371091877179]
                    }
                },
                {
                    "properties": {
                        "name": "Vung Tau, Vietnam"
                    },
                    "geometry": {
                        "coordinates": [107.07919759818566, 10.341846070577743]
                    }
                },
                {
                    "properties": {
                        "name": "Winema, OR, United States"
                    },
                    "geometry": {
                        "coordinates": [-123.97340470108611, 45.146590041565254]
                    }
                },
                {
                    "properties": {
                        "name": "Rengit, Malaysia"
                    },
                    "geometry": {
                        "coordinates": [104.11, 1.36]
                    }
                }
            ];

            // Function to create cable layer
            // Function to create cable layer
            function createCableLayer(cable) {
                // Check if this is a planned cable
                const isPlanned = ['echo', 'bifrost', 'asia-link-cable-alc', 'apricot', 'southeast-asia-japan-cable-2-sjc2', 'scnx-combined'].includes(cable.properties.id);
                
                // Use Leaflet.antimeridian to handle date line crossing
                const cableLayer = L.geoJSON(cable, {
                    style: {
                        color: cable.properties.color || '#4eb748',
                        weight: 3,
                        opacity: 0.8,
                        smoothFactor: 1,
                        dashArray: isPlanned ? '10, 10' : null
                    },
                    coordsToLatLng: function(coords) {
                        return L.latLng(coords[1], L.Util.wrapNum(coords[0], [-180, 180], true));
                    }
                });
                
                // Apply antimeridian wrapping if available
                if (typeof L.Wrapped !== 'undefined') {
                    cableLayer.eachLayer(function(layer) {
                        if (layer instanceof L.Polyline) {
                            layer.options.wrap = true;
                            layer._setLatLngs(layer.getLatLngs());
                        }
                    });
                }
                                    
                // Add interactivity
                cableLayer.eachLayer(function(layer) {
                    // Add tooltip
                    layer.bindTooltip(cable.properties.name, {
                        permanent: false,
                        direction: 'top',
                        className: 'cable-tooltip'
                    });
                    
                    // Hover effects
                    layer.on('mouseover', function(e) {
                        layer.setStyle({
                            weight: 5,
                            opacity: 1
                        });
                    });
                    
                    layer.on('mouseout', function(e) {
                        layer.setStyle({
                            weight: 3,
                            opacity: 0.8
                        });
                    });
                });
                
                return cableLayer;
            }
            
            // Function to create custom triangle icon
            function createTriangleIcon() {
                return L.divIcon({
                    html: '<div style="width: 0; height: 0; border-left: 8px solid transparent; border-right: 8px solid transparent; border-bottom: 8px solid #2d00c8; transform: rotate(135deg);"></div>',
                    className: '',  // Add this line to remove default Leaflet styling
                    iconSize: [8, 8],
                    iconAnchor: [4, 4]
                });
            }
            
            // Function to create landing point markers
            function createLandingPointMarker(point) {
                const coords = point.geometry.coordinates;
                const marker = L.marker(
                    [coords[1], coords[0]], // Leaflet uses [lat, lng]
                    {
                        icon: createTriangleIcon()
                    }
                );
                // List of points to hide names for
                const hideNames = ['Hulhumale', 'Matara', 'Machilipatnam', 'Digha', "Cox's Bazar", 'Tanjung Pakis', 
                                   'Tungku', 'Lingshui', 'Shantou', 'Karachi',
                                   'Fangshan', 'Shima', 'Chongming', 'Morib', 'Melaka', 'Satun', 'Tuas', 'Colombo',
                                   'Baler', 'Luna', 'La Union', 'Bauang', 'Rengit', 'Fujairah', 'Mumbai', 'Chennai', 'Sedili', 'Singapore', 'Batam'];
                
                // List of points to completely remove
                const removePoints = ['Kauditan', 'Mersing', 'Changi', 'Changi North', 'Tanshui',  'Vung Tau', 'Jakarta',
                                      'Nanhui', 'Chikura', 'Minamiboso', 'Cherating', 'Danang'.
                                      'Ngeremlengui', 'Magachgil', 'Quy Nhon', 'Chung Hom Kok', 
                                      'Tseung Kwan O', 'Agat', 'Alupang', 'Tanguisson Point', 'Songkhla', 'Sriracha',
                                      'Toucheng', 'Batangas', 'Makaha', 'Morro Bay', 'Hermosa Beach'];
                
                // Country codes mapping
                const countryCodes = {
                    'Malaysia': 'MYS', 'Singapore': 'SGP', 'Indonesia': 'IDN', 
                    'Philippines': 'PHL', 'Japan': 'JPN', 'China': 'CHN',
                    'Thailand': 'THA', 'Vietnam': 'VNM', 'India': 'IND',
                    'Sri Lanka': 'LKA', 'Bangladesh': 'BGD', 'South Korea': 'KOR',
                    'United States': 'USA', 'Mexico': 'MEX'
                };
                
                // Parse name
                const parts = point.properties.name.split(', ');
                const location = parts[0];
                const country = parts.slice(1).join(', ');
                // if (country.includes('United States')) {
                //     country = 'United States';
                // }
                // Check if we should skip this point entirely
                if (removePoints.some(name => location.includes(name))) {
                    return null;
                }
                
                // Rename specific locations
                let displayName = location;
                let displayCountry = country;
                if (location === 'Manado') displayName = 'Manado';
                if (location === 'Davao') displayName = 'Davao';
                if (location === 'Tuas') displayName = 'Singapore';
                if (location === 'Toucheng') displayName = 'Taiwan';
                if (location === 'Lingang') displayName = 'Shanghai';
                if (location === 'Maruyama') displayName = 'Tokyo';
                if (location === 'Piti') {
                    displayName = 'Guam';
                    displayCountry = 'Guam';
                }
                if (location === 'Keawaula') {
                    displayName = 'Hawaii';
                    displayCountry = 'USA';
                }
                if (location.includes('Chung Hom Kok') || location.includes('Tseung Kwan O') || location.includes('Lantau')) {
                    displayName = 'Hong Kong';
                    displayCountry = 'China';
                }
                if (['Agat', 'Alupang', 'Piti', 'Tanguisson Point'].includes(location)) {
                    displayName = 'Guam';
                    displayCountry = 'Guam';
                }
                if (location === 'Kuala Sedili') displayName = 'Sedili';
                
                // Add country code
                const countryCode = countryCodes[displayCountry] || '';
                const fullDisplayName = countryCode ? `${displayName}, ${countryCode}` : displayName;
                
                // Check if we should hide the name
                const shouldHideName = hideNames.some(name => location.includes(name));
                // List of major cities that should have bigger labels
                const majorCities = ['Hong Kong'];                const isMajorCity = majorCities.includes(displayName);
                    // ['Hong Kong', 'Singapore', 'Tokyo', 'Shanghai', 'Manado', 'Davao', 'Mumbai', 'Chennai', 'Jakarta', 'Batam', 'Sedili', 'Guam', 'Busan', 'Grover Beach', 'Rosarito', 'Eureka', 'Winema', 'Hawaii'];                const isMajorCity = majorCities.includes(displayName);
                // Add tooltip only if not hiding name
                if (!shouldHideName) {
                    marker.bindTooltip(
                        `<div class="landing-name">${fullDisplayName}</div>`,
                        {
                            permanent: false,
                            direction: 'top',
                            offset: [0, -10],
                            className: 'landing-tooltip'
                        }
                    );
                }
                
                // Add permanent label only if not hiding name
                // Add permanent label only if not hiding name
                let labelMarker = null;
                if (!shouldHideName) {
                    const label = L.divIcon({
                        html: `<div class="landing-label${isMajorCity ? ' major-city' : ''}">${fullDisplayName}</div>`,
                        className: 'landing-label-icon',
                        iconSize: null,
                        iconAnchor: [-10, 0]
                    });
                    
                    // Apply position offsets for overlapping cities
                    let labelLat = coords[1];
                    let labelLng = coords[0];
                    
                    if (displayName === 'Sedili') {
                        // Move right and up a tiny bit
                        labelLng += 0.15;  // right
                        labelLat += 0.80;  // up
                    } else if (displayName === 'Singapore') {
                        // Move just to the right a tiny bit
                        labelLng += 0.3;  // right
                        labelLat += 0.20;  // up
                    } else if (location === 'Batam') {
                        // Move down a medium bit
                        labelLat -= 0.6;   // down
                    }
                    
                    labelMarker = L.marker([labelLat, labelLng], {
                        icon: label,
                        interactive: false
                    });
                }
                
                return {marker: marker, label: labelMarker};
            }
            
            // Create legend item
            function createLegendItem(cable) {
                const item = document.createElement('div');
                item.className = 'cable-item';
                item.dataset.cableId = cable.properties.id;
                
                const colorBox = document.createElement('div');
                colorBox.className = 'cable-color';
                
                // Check if this is a planned cable
                const isPlanned = ['echo', 'bifrost', 'asia-link-cable-alc', 'apricot', 'southeast-asia-japan-cable-2-sjc2', 'scnx-combined'].includes(cable.properties.id);
                
                if (isPlanned) {
                    // Create dashed line using gradient
                    colorBox.style.background = `repeating-linear-gradient(90deg, ${cable.properties.color || '#4eb748'} 0px, ${cable.properties.color || '#4eb748'} 6px, transparent 6px, transparent 12px)`;
                } else {
                    // Solid color for existing cables
                    colorBox.style.backgroundColor = cable.properties.color || '#4eb748';
                }
                
                const name = document.createElement('div');
                name.className = 'cable-name';
                name.textContent = cable.properties.name;
                
                item.appendChild(colorBox);
                item.appendChild(name);
                
                // Click to toggle visibility
                item.addEventListener('click', function() {
                    const cableId = this.dataset.cableId;
                    const layer = cableLayers[cableId];
                    
                    if (map.hasLayer(layer)) {
                        map.removeLayer(layer);
                        this.classList.add('hidden');
                    } else {
                        map.addLayer(layer);
                        this.classList.remove('hidden');
                    }
                });
                
                return item;
            }
            
            // Initialize map with data
            const cableList = document.getElementById('cable-list');
            
            // Add all cables
            // Add all cables
            const plannedCables = ['echo', 'bifrost', 'asia-link-cable-alc', 'apricot', 'southeast-asia-japan-cable-2-sjc2', 'scnx-combined'];
            
            // Sort cables: existing first, then planned
            const sortedCables = cables.sort((a, b) => {
                const aIsPlanned = plannedCables.includes(a.properties.id);
                const bIsPlanned = plannedCables.includes(b.properties.id);
                if (aIsPlanned && !bIsPlanned) return 1;
                if (!aIsPlanned && bIsPlanned) return -1;
                return 0;
            });
            
            sortedCables.forEach(cable => {
                console.log('Adding cable:', cable.properties.name);
                const layer = createCableLayer(cable);
                cableLayers[cable.properties.id] = layer;
                layer.addTo(map);
                
                const legendItem = createLegendItem(cable);
                cableList.appendChild(legendItem);
            });
            
            // Add all landing points
            console.log('Adding', landingPoints.length, 'landing points');
            const landingPointGroup = L.layerGroup();
            const landingLabelGroup = L.layerGroup();
            
            landingPoints.forEach(point => {
                const result = createLandingPointMarker(point);
                if (result) {
                    const {marker, label} = result;
                    landingPointGroup.addLayer(marker);
                    if (label) {
                        landingLabelGroup.addLayer(label);
                    }
                }
            });
            
            landingPointGroup.addTo(map);
            landingLabelGroup.addTo(map);
            
            console.log('Map initialization complete!');
        }
    </script>
</body>
</html>
